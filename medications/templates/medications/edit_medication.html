{% extends "core/base.html" %}
{% load static %}

{% block content %}
<style>
  .form-container {
    max-width: 700px;
    margin: 0 auto;
    background-color: #f0f8ff;
    padding: 24px;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  }
  .form-row {
    display: flex;
    align-items: center;
    margin-bottom: 14px;
  }
  .form-label-col {
    flex: 0 0 240px;
    min-width: 240px;
    font-weight: 500;
    padding-right: 16px;
    text-align: left;
  }
  .form-input-col {
    flex: 1;
  }
</style>

<div class="container mt-5">
  <h2 class="text-center mb-4">Edytuj lek</h2>

  <div class="form-container">
    <form method="post">
      {% csrf_token %}

      <div class="form-row">
        <div class="form-label-col">Nazwa leku:</div>
        <div class="form-input-col">{{ form.name }}</div>
      </div>

      <div class="form-row">
        <div class="form-label-col">Syrop?</div>
        <div class="form-input-col">
          <span style="display:none;">{{ form.form }}</span>
          <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" id="isSyrupSwitch">
          </div>
        </div>
      </div>

      <div id="tablet-fields">
        <div class="form-row">
          <div class="form-label-col">Ilość tabletek w opakowaniu:</div>
          <div class="form-input-col">{{ form.quantity }}</div>
        </div>
        <div class="form-row">
          <div class="form-label-col">Ilość tabletek na dawkę:</div>
          <div class="form-input-col">{{ form.dosage_amount }}</div>
        </div>
      </div>

      <div id="syrup-fields" style="display:none;">
        <div class="form-row">
          <div class="form-label-col">Objętość syropu (ml):</div>
          <div class="form-input-col">{{ form.volume_ml }}</div>
        </div>
        <div class="form-row">
          <div class="form-label-col">Dawka syropu (ml):</div>
          <div class="form-input-col">{{ form.dosage_ml_per_time }}</div>
        </div>
      </div>

      <div class="form-row">
        <div class="form-label-col">Częstotliwość dawkowania (na dobę):</div>
        <div class="form-input-col">{{ form.frequency }}</div>
      </div>

      <div class="form-row">
        <div class="form-label-col">Data rozpoczęcia:</div>
        <div class="form-input-col">
          <input type="date" name="start_date" class="form-control"
                 value="{{ form.instance.start_date|date:'Y-m-d' }}">
        </div>
      </div>

      <div class="form-row">
        <div class="form-label-col">Czy lek na receptę?</div>
        <div class="form-input-col">
          <div class="form-check form-switch">
            {{ form.prescription_required }}
          </div>
        </div>
      </div>

      <div class="form-row">
        <div class="form-label-col">Data ważności:</div>
        <div class="form-input-col">
          <input type="date" name="expiration_date" class="form-control"
                 value="{{ form.instance.expiration_date|date:'Y-m-d' }}">
        </div>
      </div>

      <div class="text-center mt-3">
        <button type="submit" class="btn btn-dark me-2">Zapisz zmiany</button>
        <a href="{% url 'medication_list' %}" class="btn btn-secondary">Anuluj</a>
      </div>
    </form>
  </div>
</div>

<script>
  const syrupSwitch = document.getElementById('isSyrupSwitch');
  const syrupFields = document.getElementById('syrup-fields');
  const tabletFields = document.getElementById('tablet-fields');
  const formField = document.querySelector('input[name="form"]');

  function applyState(isSyrup) {
    syrupFields.style.display = isSyrup ? 'block' : 'none';
    tabletFields.style.display = isSyrup ? 'none' : 'block';
    if (formField) formField.value = isSyrup ? 'syrup' : 'tablet';
  }

  function initFromCurrent() {
    const current = formField ? (formField.value || '').toLowerCase() : '';
    const isSyrup = current === 'syrup' || current === 'syrop';
    syrupSwitch.checked = isSyrup;
    applyState(isSyrup);
  }

  document.addEventListener('DOMContentLoaded', () => {
    initFromCurrent();
    syrupSwitch.addEventListener('change', () => applyState(syrupSwitch.checked));
  });
</script>
{% endblock %}

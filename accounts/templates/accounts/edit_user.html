{% extends "core/base.html" %}
{% block content %}

<style>
  .wrap { max-width: 660px; margin: 24px auto; }
  .blue-frame { border: 2px solid rgba(13,110,253,.6); border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,.1); }
  .soft-bg { background-color: #eef6ff; }
  .panel { padding: 14px 16px 16px 16px; }
  .form-label { display:block; text-align:center; }
  .panel .form-control { padding: .6rem .8rem; font-size: 1rem; }
  .card-tabs { margin: 6px 0 8px; }
  .card-tabs .nav-link{
    border: 1px solid rgba(13,110,253,.25);
    border-radius: 999px;
    margin: 0 .3rem;
    padding: .45rem 1rem;
    background: #e9f3ff;
    color: #0d6efd;
    font-weight: 500;
  }

  .card-tabs .nav-link.active{
    background: #0d6efd;
    color: #fff;
    border-color: #0d6efd;
    box-shadow: 0 2px 6px rgba(13,110,253,.25);
  }
</style>

<div class="wrap">
  <h2 class="text-center mb-3">Aktualizacja danych</h2>

  <div class="alert alert-info alert-dismissible fade show alert-sticky small text-center mb-3" role="alert">
    <i class="bi bi-info-circle me-1"></i>
    Wprowadź <strong>nowe wartości</strong> tylko w polach, które chcesz zaktualizować.
    Zmiana hasła jest <strong>opcjonalna</strong> - wypełnij wszystkie pola hasła, jeśli chcesz je zmienić.
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>

  <div class="blue-frame soft-bg panel">
    <ul class="nav nav-pills justify-content-center card-tabs" role="tablist">
      <li class="nav-item" role="presentation">
        <button
          class="nav-link {% if active_tab != 'password' %}active{% endif %}"
          id="tab-profile" data-bs-toggle="tab" data-bs-target="#pane-profile"
          type="button" role="tab" aria-controls="pane-profile"
          aria-selected="{% if active_tab != 'password' %}true{% else %}false{% endif %}">
          Dane podstawowe
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button
          class="nav-link {% if active_tab == 'password' %}active{% endif %}"
          id="tab-password" data-bs-toggle="tab" data-bs-target="#pane-password"
          type="button" role="tab" aria-controls="pane-password"
          aria-selected="{% if active_tab == 'password' %}true{% else %}false{% endif %}">
          Zmiana hasła
        </button>
      </li>
    </ul>

    <div class="tab-content pt-1">
      <div class="tab-pane fade {% if active_tab != 'password' %}show active{% endif %}" id="pane-profile" role="tabpanel" aria-labelledby="tab-profile">
        <form method="post" novalidate>
          {% csrf_token %}
          {% if profile_form.non_field_errors %}
            <div class="alert alert-danger text-center">{{ profile_form.non_field_errors }}</div>
          {% endif %}

          <div class="mb-3">
            <label class="form-label">{{ profile_form.first_name.label }}</label>
            {{ profile_form.first_name }}
            {% for e in profile_form.first_name.errors %}<div class="text-danger small text-center">{{ e }}</div>{% endfor %}
          </div>
          <div class="mb-3">
            <label class="form-label">{{ profile_form.last_name.label }}</label>
            {{ profile_form.last_name }}
            {% for e in profile_form.last_name.errors %}<div class="text-danger small text-center">{{ e }}</div>{% endfor %}
          </div>
          <div class="mb-3">
            <label class="form-label">{{ profile_form.date_of_birth.label }}</label>
            {{ profile_form.date_of_birth }}
            {% for e in profile_form.date_of_birth.errors %}<div class="text-danger small text-center">{{ e }}</div>{% endfor %}
          </div>
          <div class="mb-3">
            <label class="form-label">{{ profile_form.email.label }}</label>
            {{ profile_form.email }}
            {% for e in profile_form.email.errors %}<div class="text-danger small text-center">{{ e }}</div>{% endfor %}
          </div>

          <div class="d-flex justify-content-center gap-2">
            <button type="submit" name="profile_submit" class="btn btn-dark">Zapisz</button>
            <a href="{% url 'accounts:settings' %}" class="btn btn-secondary">Anuluj</a>
          </div>
        </form>
      </div>

      <div class="tab-pane fade {% if active_tab == 'password' %}show active{% endif %}" id="pane-password" role="tabpanel" aria-labelledby="tab-password">
        <form method="post" novalidate>
          {% csrf_token %}

          <div class="mb-3">
            <label class="form-label">{{ pwd_form.old_password.label }}</label>
            {{ pwd_form.old_password }}
            {% for e in pwd_form.old_password.errors %}<div class="text-danger small text-center">{{ e }}</div>{% endfor %}
          </div>
          <div class="mb-3">
            <label class="form-label">{{ pwd_form.new_password1.label }}</label>
            {{ pwd_form.new_password1 }}
            {% for e in pwd_form.new_password1.errors %}<div class="text-danger small text-center">{{ e }}</div>{% endfor %}
          </div>
          <div class="mb-1">
            <label class="form-label">{{ pwd_form.new_password2.label }}</label>
            {{ pwd_form.new_password2 }}
            {% for e in pwd_form.new_password2.errors %}<div class="text-danger small text-center">{{ e }}</div>{% endfor %}
          </div>
          <p class="text-muted small text-center mb-3">Pozostaw pola puste, jeśli nie chcesz zmieniać hasła.</p>

          <div class="d-flex justify-content-center gap-2">
            <button type="submit" name="password_submit" class="btn btn-dark">Zapisz</button>
            <a href="{% url 'accounts:settings' %}" class="btn btn-secondary">Anuluj</a>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
{% endblock %}
